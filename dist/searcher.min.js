window.Searcher=class Searcher{constructor(e,t){this.database=t.database||{},this.SHOW_NUM=t.SHOW_NUM||40,this.href_key=t.href_key||null,this.updateDatabase(this.database),this.initializeDOM(e),this.createEventListener()}initializeDOM(e){this.dom={},this.dom.parent=e,this.dom.parent.classList.add("app"),this.dom.container=this.createAndAppendElement(e,"div",{class:"searcher-container"}),this.dom.seacher=this.createAndAppendElement(this.dom.container,"div",{class:"searcher"}),this.dom.input=this.createAndAppendElement(this.dom.seacher,"input",{class:"searcher-input",placeholder:"keywords..."}),this.dom.cardsContainer=this.createAndAppendElement(this.dom.container,"div",{class:"cards-container"}),this.dom.input.focus()}updateDatabase(e){this.database=e,this.TOTAL_NUM=Object.keys(this.database).length}addMark(e,t){const a=new RegExp(t,"gi");return(e=e.replace(/(<mark>|<\/mark>)/gim,"")).replace(a,"<mark>$&</mark>")}createCard(e,t,a=null){const s=t.k.join("/");let r;r=this.href_key&&t[this.href_key]||"#";const n=this.createAndAppendElement(e,"a",{class:"card",href:r}),i=this.createAndAppendElement(n,"div",{class:"card-container"}),d=this.createAndAppendElement(i,"h4",{class:"card-title",innerText:`${t.n}`}),c=this.createAndAppendElement(i,"p",{class:"card-keys",innerText:`${s}`});return a&&(d.innerHTML=this.addMark(d.innerHTML,a),c.innerHTML=this.addMark(c.innerHTML,a)),n}createAndAppendElement(e,t,a={}){const s=document.createElement(t);return a.class&&(a.class.split(" ").forEach((e=>s.classList.add(e))),delete a.class),a.dataset&&(Object.keys(a.dataset).forEach((e=>s.dataset[e]=a.dataset[e])),delete a.dataset),Object.keys(a).forEach((e=>s[e]=a[e])),e.appendChild(s),s}search(e){const t=e.target.value.trim();if(!t)return void(this.dom.cardsContainer.innerHTML="");const a=document.createDocumentFragment(),s=Object.values(this.database);var r=1;for(let e of s)if(this.parseKeyword(t,e)&&(this.createCard(a,e,t),++r>=this.SHOW_NUM))break;this.dom.cardsContainer.innerHTML="",this.dom.cardsContainer.appendChild(a)}createEventListener(){this.dom.input&&this.search&&(this.search=this.search.bind(this),this.dom.input.addEventListener("input",this.search))}parseKeyword(e,t){const a=e.toLowerCase().split(","),s=a[0],r=(a[1],t.n||""),n=t.k||[];if(r.toLowerCase().includes(s))return!0;for(let e of n)if(e.toLowerCase().includes(s))return!0;return!1}};